<div id="order-progress">
  <% projects_count = current_order.projects.size %>
  <% percent = current_order.minimum_projects_rule? ? (projects_count / current_order.minimum_projects.to_f * 100).clamp(0, 100) : current_order_budget_percent %>
  <% selected = "#{projects_count} #{t("selected_projects", scope: "decidim.budgets.projects.order_selected_projects", count: projects_count)}" %>
  <% label = current_order.minimum_projects_rule? ? selected : current_order_budget_percent.to_s + "%" %>
  
  <div class="budget-summary__progressbox" data-current-allocation="<%= current_order ? current_order.total : 0 %>">
    <div class="progress budget-progress" role="progressbar" aria-valuenow="<%= percent %>" aria-valuetext="<%= label %>%" aria-valuemin="0" aria-valuemax="100">
      <div class="progress-meter progress-meter--minimum" style="width: <%= current_order_budget_percent_minimum %>%"></div>
      <!--Change width and text dynamically.-->
      <div class="progress-meter budget-progress__meter" style="width: <%= percent %>%">
        <span class="progress-meter-text progress-meter-text--right"><%= label %></span>
      </div>
    </div>
    <% if !current_order_checked_out? && voting_open? %>
      <button class="button small button--sc" data-toggle="budget-confirm" <%= budget_confirm_disabled_attr %>>
        <%= t(".vote") %>
      </button>
    <% end %>
  </div>
</div>
