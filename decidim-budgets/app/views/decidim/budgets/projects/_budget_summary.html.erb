<div class="card budget-summary" data-progress-reference data-safe-url="<%= budget_url(budget) %>">
  <div class="card__content">
    <h3 class="heading3">
      <% if current_order_checked_out? %>
        <%= t(".checked_out.title") %>
        <% unless current_workflow.single? %>
          <small><%= translated_attribute(budget.title) %></small>
        <% end %>
      <% else %>
        <% if current_workflow.single? %>
          <%= t(".title") %>
        <% else %>
          <%= translated_attribute(budget.title) %>
        <% end %>
      <% end %>
    </h3>

    <p>
      <% if current_order_checked_out? %>
        <%= raw current_rule_description %>
      <% else %>
        <%= raw t(".checked_out.description", cancel_link: link_to(t(".cancel_order"), budget_order_path(return_to: "budget"), method: :delete, class: "cancel-order", data: { confirm: t(".are_you_sure") })) %>
      <% end %>
    </p>

    <div class="callout warning voting-rules">
      <div class="row">
        <div class="columns medium-8 large-9">
          <h3 class="heading3">
            <%= t(".rules.title") %>
          </h3>
          <ul>
            <%= raw current_rule_explanation %>
          </ul>
        </div>
      </div>
    </div>

    <% if current_order.projects_rule? %>
      <div class="budget-summary__total" data-total-allocation="<%= current_order.available_allocation %>">
        <span class="mini-title"><%= t(".total_projects") %>
          <strong class="mini-title__strong mini-title__strong--highlight">
            <%= current_order.maximum_projects %>
          </strong>
        </span>
      </div>
    <% else %>
      <div class="budget-summary__total" data-total-allocation="<%= current_order.available_allocation %>" data-total-budget="<%= budget.total_budget %>">
        <span class="mini-title"><%= t(".total_budget") %>
          <strong class="mini-title__strong mini-title__strong--highlight">
            <%= budget_to_currency(budget.total_budget) %>
          </strong>
        </span>
      </div>
    <% end %>

    <div class="budget-summary__progressbox budget-summary__progress--bar" data-current-allocation="<%= current_order ? current_order.total : 0 %>">
      <div class="progress budget-progress" role="progressbar" aria-valuenow="<%= current_order_budget_percent %>" aria-valuetext="<%= current_order_budget_percent %>%" aria-valuemin="0" aria-valuemax="100">
        <div class="progress-meter progress-meter--minimum" style="width: <%= current_order_budget_percent_minimum %>%"></div>
        <!--Change width and text dynamically.-->
        <div class="progress-meter budget-progress__meter" style="width: <%= current_order_budget_percent %>%">
          <span class="progress-meter-text progress-meter-text--right"><%= current_order_budget_percent %>%</span>
        </div>
      </div>
      <% if !current_order_checked_out? && voting_open? %>
        <button class="button small button--sc" data-toggle="budget-confirm" <%= budget_confirm_disabled_attr %>>
          <%= t(".vote") %>
        </button>
      <% end %>
    </div>

    <div>
      <span class="mini-title">
        <%= t(".assigned") %>
        <%= render partial: "order_total_budget" %>
      </span>
    </div>

    <%= cell("decidim/budgets/budget_information_modal", budget) %>
  </div>

  <%= render partial: "order_selected_projects" %>
</div>

<%= render partial: "budget_excess" %>
<%= render partial: "budget_confirm" %>
